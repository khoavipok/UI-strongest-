local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local UILibrary = {}

-- ðŸ”´ðŸ–¤ RED BLACK COLOR ONLY (SAFE)
local C_BG_MAIN   = Color3.fromRGB(14,14,14)
local C_BG_TOP    = Color3.fromRGB(22,22,22)
local C_BG_ITEM   = Color3.fromRGB(30,30,30)

local C_RED_MAIN  = Color3.fromRGB(160,35,35)
local C_RED_DARK  = Color3.fromRGB(120,25,25)
local C_RED_HOVER = Color3.fromRGB(200,55,55)

local C_TEXT_MAIN = Color3.fromRGB(255,210,210)
local C_TEXT_DIM  = Color3.fromRGB(200,170,170)

function UILibrary:CreateWindow(title, size)
    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    ScreenGui.Name = "BaconBossUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Overlay
    local Overlay = Instance.new("Frame", ScreenGui)
    Overlay.Size = UDim2.new(1,0,1,0)
    Overlay.BackgroundColor3 = Color3.fromRGB(0,0,0)
    Overlay.BackgroundTransparency = 0.7
    Overlay.ZIndex = 1
    Overlay.Visible = true
    
    -- Main window
    local MainFrame = Instance.new("Frame", ScreenGui)
    MainFrame.Size = size or UDim2.new(0,520,0,340)
    MainFrame.Position = UDim2.new(0.5,-260,0.5,-170)
    MainFrame.BackgroundColor3 = C_BG_MAIN
    MainFrame.ZIndex = 10
    MainFrame.Active = true
    MainFrame.ClipsDescendants = true
    
    Instance.new("UICorner",MainFrame).CornerRadius = UDim.new(0,12)
    local Stroke = Instance.new("UIStroke",MainFrame)
    Stroke.Color = C_RED_DARK
    Stroke.Thickness = 2
    Stroke.Transparency = 0.3
    
    -- Top bar
    local TopBar = Instance.new("Frame", MainFrame)
    TopBar.Size = UDim2.new(1,0,0,40)
    TopBar.BackgroundColor3 = C_BG_TOP
    TopBar.ZIndex = 12
    TopBar.Active = true
    
    Instance.new("UICorner",TopBar).CornerRadius = UDim.new(0,12)
    
    -- Title
    local Title = Instance.new("TextLabel", TopBar)
    Title.Text = title or "ðŸ©¸ khanhlyHUB"
    Title.TextColor3 = C_TEXT_MAIN
    Title.BackgroundTransparency = 1
    Title.Font = Enum.Font.GothamBold
    Title.Position = UDim2.new(0,15,0,0)
    Title.Size = UDim2.new(1,-60,1,0)
    Title.TextSize = 16
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.ZIndex = 13
    
    -- Toggle button
    local ToggleBtn = Instance.new("TextButton", TopBar)
    ToggleBtn.Size = UDim2.new(0,34,0,34)
    ToggleBtn.Position = UDim2.new(1,-42,0.5,-17)
    ToggleBtn.BackgroundColor3 = C_RED_DARK
    ToggleBtn.Text = "-"
    ToggleBtn.TextColor3 = C_TEXT_MAIN
    ToggleBtn.Font = Enum.Font.GothamBold
    ToggleBtn.TextSize = 18
    ToggleBtn.ZIndex = 13
    ToggleBtn.AutoButtonColor = false
    
    Instance.new("UICorner",ToggleBtn).CornerRadius = UDim.new(0,8)
    local ToggleStroke = Instance.new("UIStroke",ToggleBtn)
    ToggleStroke.Color = C_RED_MAIN
    ToggleStroke.Thickness = 2
    
    -- ScrollFrame
    local ScrollFrame = Instance.new("ScrollingFrame", MainFrame)
    ScrollFrame.Size = UDim2.new(1,0,1,-50)
    ScrollFrame.Position = UDim2.new(0,0,0,45)
    ScrollFrame.BackgroundTransparency = 1
    ScrollFrame.ZIndex = 11
    ScrollFrame.ScrollBarThickness = 6
    ScrollFrame.ScrollBarImageColor3 = C_RED_MAIN
    ScrollFrame.BorderSizePixel = 0
    ScrollFrame.CanvasSize = UDim2.new(0,0,0,0)
    
    local Container = Instance.new("Frame", ScrollFrame)
    Container.Size = UDim2.new(1,0,0,0)
    Container.BackgroundTransparency = 1
    
    local Layout = Instance.new("UIListLayout", Container)
    Layout.Padding = UDim.new(0,10)
    Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    Instance.new("UIPadding",Container).PaddingTop = UDim.new(0,10)
    
    Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Container.Size = UDim2.new(1,0,0,Layout.AbsoluteContentSize.Y)
        ScrollFrame.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y + 20)
    end)

    -- Toggle UI (GIá»® NGUYÃŠN LOGIC)
    local Hidden = false
    ToggleBtn.MouseButton1Click:Connect(function()
        Hidden = not Hidden
        ScrollFrame.Visible = not Hidden
        Overlay.Visible = not Hidden
        ToggleBtn.Text = Hidden and "+" or "-"
    end)

    ToggleBtn.MouseEnter:Connect(function()
        ToggleBtn.BackgroundColor3 = C_RED_HOVER
    end)
    ToggleBtn.MouseLeave:Connect(function()
        ToggleBtn.BackgroundColor3 = C_RED_DARK
    end)
    ToggleBtn.MouseButton1Down:Connect(function()
        ToggleBtn.BackgroundColor3 = C_RED_MAIN
    end)
    ToggleBtn.MouseButton1Up:Connect(function()
        ToggleBtn.BackgroundColor3 = C_RED_HOVER
    end)

    local Window = {}
    function Window:GetContainer()
        return Container
    end

    -- Button
    function Window:CreateButton(text, callback)
        local Btn = Instance.new("TextButton", Container)
        Btn.Size = UDim2.new(1,-20,0,40)
        Btn.BackgroundColor3 = C_BG_ITEM
        Btn.Text = text
        Btn.TextColor3 = C_TEXT_MAIN
        Btn.Font = Enum.Font.GothamSemibold
        Btn.TextSize = 14
        Btn.AutoButtonColor = false
        
        Instance.new("UICorner",Btn).CornerRadius = UDim.new(0,8)
        local BtnStroke = Instance.new("UIStroke",Btn)
        BtnStroke.Color = C_RED_MAIN
        BtnStroke.Thickness = 1.5
        
        Btn.MouseEnter:Connect(function()
            Btn.BackgroundColor3 = C_RED_DARK
            BtnStroke.Color = C_RED_HOVER
        end)
        Btn.MouseLeave:Connect(function()
            Btn.BackgroundColor3 = C_BG_ITEM
            BtnStroke.Color = C_RED_MAIN
        end)
        
        Btn.MouseButton1Click:Connect(function()
            if callback then pcall(callback) end
        end)
        return Btn
    end

    -- Label
    function Window:CreateLabel(text)
        local Label = Instance.new("TextLabel", Container)
        Label.Size = UDim2.new(1,-20,0,28)
        Label.BackgroundTransparency = 1
        Label.Font = Enum.Font.GothamMedium
        Label.TextSize = 14
        Label.TextColor3 = C_TEXT_DIM
        Label.TextXAlignment = Enum.TextXAlignment.Left
        Label.Text = text
        return Label
    end

    return Window
end

return UILibrary
